<nav class="navbar navbar-expand-lg sticky-top navbar-dark bg-dark" role="navigation">
    <div class="container-fluid">
        <a class="navbar-brand text-white" href="/">
            <img width="35" height="35" src="/favicon.png">
            Weird Person's Website
        </a>

        <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target=".navbar-collapse" aria-controls=".navbar-collapse" aria-expanded="false" aria-label="Toggle navigation">
            <span class="navbar-toggler-icon"></span>
        </button>

        <div class="collapse navbar-collapse">
            <ul class="navbar-nav me-auto mb-2 mb-lg-0">
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Utilities
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="/utils/">Everything</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/yt/">YouTube Ad-Free Viewer</a></li>
                        <li><a class="dropdown-item" href="/short/">URL Shortener</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Random Stuff
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="/random/">Everything</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="/commits/">Commit History</a></li>
                        <li><a class="dropdown-item" href="/personbot/">PersonBot</a></li>
                    </ul>
                </li>
                <li class="nav-item dropdown">
                    <a class="nav-link dropdown-toggle text-white" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
                        Source
                    </a>
                    <ul class="dropdown-menu" aria-labelledby="navbarDropdown">
                        <li><a class="dropdown-item" href="/source/">Everything</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="https://github.com/imaperson1060/imaperson.dev/tree/main/socket/yt" target="_blank">YouTube Ad-Free Viewer Source</a></li>
                        <li><a class="dropdown-item" href="https://github.com/imaperson1060/imaperson.dev/tree/main/socket/short" target="_blank">URL Shortener Source</a></li>
                        <li><hr class="dropdown-divider"></li>
                        <li><a class="dropdown-item" href="https://github.com/imaperson1060/imaperson.dev/tree/main/static" target="_blank">Website Source</a></li>
                        <li><a class="dropdown-item" href="https://github.com/imaperson1060/imaperson.dev" target="_blank">API Source</a></li>
                    </ul>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="/contact/">Contact</a>
                </li>
                <li class="nav-item">
                    <a class="nav-link text-white" href="/about/">About</a>
                </li>
            </ul>

            <div id="log-in-out" class="d-flex"></div>
        </div>
    </div>
</nav>

<div class="modal fade" id="login" tabindex="-1" aria-labelledby="loginLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="loginLabel">Login</h5>
                <button id="closeLoginX" type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <div class="input-group flex-nowrap mb-3">
                    <span class="input-group-text" id="usernameIcon"><i class="bi bi-person-circle"></i></span>
                    <input class="form-control" id="login-username" placeholder="Username" aria-label="username" area-descibedby="usernameIcon">
                </div>
    
                <div class="input-group flex-nowrap mb-3">
                    <span class="input-group-text" id="passwordIcon"><i class="bi bi-lock-fill"></i></span>
                    <input type="password" class="form-control" id="login-password" placeholder="Password" aria-label="password" area-descibedby="passwordIcon">
                </div>
                    
                <div id="response" class="mb-3"></div>
            </div>
    
            <div class="modal-footer">
                <button id="loginBtn" type="submit" class="btn btn-primary" onclick="socket.emit('accounts', 'login', { username: $('#login-username').val(), password: $('#login-password').val() });" style="margin-left: inherit !important;">Login</button>
                <button id="signUpBtn" type="submit" class="btn btn-secondary" onclick="window.open('/signup.html', 'signupWindow', 'width=500,height=500');" style="margin-left: inherit !important;">Signup</button>
                <button id="forgotBtn" type="submit" class="btn btn-danger" onclick="window.open('/forgot.html', 'signupWindow', 'width=500,height=350');" style="margin-left: inherit !important;">Forgot Password</button>
                <button id="closeLogin" type="button" class="btn btn-secondary" style="margin-left: auto !important;" data-bs-dismiss="modal">Close</button>
            </div>
        </div>
    </div>
</div>

<script src="https://cdnjs.cloudflare.com/ajax/libs/blueimp-md5/2.19.0/js/md5.min.js"></script>
<script>
    const errors = (err) => {
        switch (err) {
            case "ratelimit": return "Only one account can be created every 15 minutes.";
            case "invalidargs": return "Invalid arguments were provided.";
            case "long": return `Username "${$("#login-username").val()}" is too long.`;
            case "invalidemail": return `Email "${$("#login-email").val()}" is invalid.`;
            case "taken": return `Username "${$("#login-username").val()}" has been taken.`;
            case "emailused": return `Email "${$("#login-email").val()}" is already linked to an account.`;
            case "noaccount": return `Username "${$("#login-username").val()}" does not exist.`;
            case "wrongpass": return `Password "${$("#login-password").val()}" is incorrect.`;
            case "noaccountlinked": return `Email "${$("#login-email").val()}" not linked to any account.`;
            case "wrongcode": return "Access code incorrect.";
        }
    }

    if (localStorage.getItem("auth")) {
        var auth = JSON.parse(localStorage.getItem("auth"));

        socket.emit("accounts", "login", { username: auth.username, password: auth.password, sender: "load" });

        $("#log-in-out").html(`<a class="navbar-brand text-white" href="#" onclick="localStorage.clear();location.reload();" style="margin-left: auto !important;"><span class="lead">Hi, ${auth.username} /</span> Logout</a>`);
    } else {
        $("#log-in-out").html(`<a class="navbar-brand text-white" href="#" data-bs-toggle="modal" data-bs-target="#login" style="margin-left: auto !important;">Login</a>`);
    }

    socket.on("accounts-login", (data) => {
        if (data.args[0].sender == "load") {
            if (!data.success) {
                localStorage.removeItem("auth");
                location.reload();
            }
            return;
        }

        if (data.success) {
            localStorage.setItem("auth", `{ "username": "${document.getElementById("login-username").value}", "password": "${$("#login-password").val()}" }`);
            $("#response").html(`<div class="alert alert-success alert-dismissible fade show" role="alert"> <strong>Success!</strong> Logged in as ${$("#login-username").val()}.</div>`);
            $("#loginBtn").remove();
            $("#signUpBtn").remove();
            $("#forgotBtn").remove();

            $("#closeLogin").click(() => location.reload());
            $("#closeLoginX").click(() => location.reload());

            $("body").click(() => location.reload());
        } else {
            $("#response").html(`<div class="alert alert-danger alert-dismissible fade show" role="alert"> <strong>Error!</strong> ${errors(data.message)}</div>`);
        }
    });
</script>